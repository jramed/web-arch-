<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Universal - All In 1 Template</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <!-- Bootstrap CSS-->
    <link rel="stylesheet" href="/vendor/bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome CSS-->
    <link rel="stylesheet" href="/vendor/font-awesome/css/font-awesome.min.css">
    <!-- Google fonts - Roboto-->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,700">
    <!-- Bootstrap Select-->
    <link rel="stylesheet" href="/vendor/bootstrap-select/css/bootstrap-select.min.css">
    <!-- owl carousel-->
    <link rel="stylesheet" href="/vendor/owl.carousel/assets/owl.carousel.css">
    <link rel="stylesheet" href="/vendor/owl.carousel/assets/owl.theme.default.css">
    <!-- theme stylesheet-->
    <link rel="stylesheet" href="/css/style.default.css" id="theme-stylesheet">
    <!-- Custom stylesheet - for your changes-->
    <link rel="stylesheet" href="/css/custom.css">
    <!-- Favicon and apple touch icons-->
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="img/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="57x57" href="img/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="72x72" href="img/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="img/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="img/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="img/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="img/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="img/apple-touch-icon-152x152.png">
    <!-- Tweaks for older IEs--><!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
    
    <script src="/vendor/jquery/jquery.min.js"></script>
    <script src="/js/disable_order_submit_button.js"></script>
	
	<script>
	    //check if some field is still emtpy in form
	    //useful when the removed field was the one
	    //that disable the submit button
		function checkEmptiness(){
			console.log("checkEmptiness");
	        var empty = false;
			$('.form-form input').each( function() {
				console.log("inside function each check Emptiness");
				console.log("Value: " + this.value)
				if ($.trim(this.value).length == 0) {
					console.log("empty");
					empty = true;
				}
			});
		
			if (!empty) {
				$('#submit-order-button').attr('disabled', false);
				//$('#submit-order-button').removeClass("btn-secondary");
				$('#submit-order-button').addClass("btn-template-outlined");
				console.log("enabled");
			} else {
				$('#submit-order-button').attr('disabled', true);
				$('#submit-order-button').removeClass("btn-template-outlined");
				//$('#submit-order-button').addClass("btn-secondary");
				console.log("disabled");
			}
		}
	</script>
	
	<script>
		function waGetNumberFromId(waIdElement){
			var waTokenizedId = waIdElement.split("-",3);
			//console.log("The string is: " + waTokenizedId[2]);
			return waTokenizedId[2];
		}
		

		$(document).ready(function() {
			//use event delegation because the button was dinamically added
			//https://learn.jquery.com/events/event-delegation/
			$('.form-form').on('click', '.wa-remove-element', function() {
				var waOwnId = this.id;
				var waIdTableRow = "wa-row-" + waGetNumberFromId(waOwnId);
				var numItems = $('.wa-remove-element').length;
				if (numItems > 1) {
					$("#" + waIdTableRow).remove();
					checkEmptiness();
				}
				
				//The number of item was 2, so after the removal only left
				//one, so remove the trash button
				if (numItems == 2)
				{
					$('.wa-remove-element').remove();
					//Add class to allow add the trash button to first field 
					//when added the second one
					$('.wa-add-class').addClass('wa-trash-button');
				}
			});
		});
	//If the button was disabled and the empty field is removed, then the button is not enabled FIX IT
	</script>
	
	<script>
		function selectHigherId() {
			var waHigherId = 2;
			$('.wa-row').each(function(){
				console.log("this.id: " + this.id + "higher id: "+ waHigherId);
				var waLocalId = waGetNumberFromId(this.id);
				if (waHigherId < waLocalId) {
					waHigherId = waLocalId;
					console.log("waHigherId: "+waHigherId);
				}
			});
			return ++waHigherId;
		}

		function my_button_click_handler() {
			$(document).ready(function(){
				var waCount = selectHigherId();
				console.log("waCount: "+ waCount);
				//Disable the submit button because new empty field is added
				$('#submit-order-button').attr('disabled',true);
				$('#submit-order-button').removeClass("btn-template-outlined");
				//$('#submit-order-button').addClass("btn-secondary");
				console.log("button disabled");
				$(".wa-insert-new-text-box").before('\
						<tr class="wa-row" id="wa-row-' +waCount+'"><div class="form-group">\
						<td>\
	                        <input id="order-element-'+ waCount +'" type="text" name="productNames[]" class="form-control">\
	                    </td>\
	                    <td><div class="wa-add-class" </div>\
	                        <button type="button" class="wa-remove-element" id="delete-element-' + waCount+ '">\
						    <i class="fa fa-trash"></i></button>\
						</td>\
						</div>\
						</tr>\
                ')
                
                waCount++;
				
                
                //If number of field is 1, the first field does not have trash button
                if ($('.wa-remove-element').length == 1){
                	//if the first field was removed before add the button, the number
                	//must be gathered from the tr id, because it is not 1.
                	var waIdNumber = waGetNumberFromId($('.wa-row')[0].id);
                	//console.log("number got from tr: ", waIdNumber);
					$('.wa-trash-button').after('<button type="button" id="delete-elemen-'+ waIdNumber +'" class="wa-remove-element" >\
											<i class="fa fa-trash"></i></button>');
					//Remove the class to avoid to add more that one button to first field
					$("div").removeClass("wa-trash-button");
				}
                
			});
			return false;
		}
	</script>
</head>
  <body>
    <div id="all">
      <!-- Top bar-->
      <div class="top-bar">
        <div class="container">
          <div class="row d-flex align-items-center">
            <div class="col-md-6 d-md-block d-none">
              <p>Contact us on +420 777 555 333 or hello@universal.com.</p>
            </div>
            <div class="col-md-6">
              <div class="d-flex justify-content-md-end justify-content-between">
                <ul class="list-inline contact-info d-block d-md-none">
                  <li class="list-inline-item"><a href="#"><i class="fa fa-phone"></i></a></li>
                  <li class="list-inline-item"><a href="#"><i class="fa fa-envelope"></i></a></li>
                </ul>
                <div class="login"><a href="#" data-toggle="modal" data-target="#login-modal" class="login-btn"><i class="fa fa-sign-in"></i><span class="d-none d-md-inline-block">Sign In</span></a><a href="customer-register.html" class="signup-btn"><i class="fa fa-user"></i><span class="d-none d-md-inline-block">Sign Up</span></a></div>
                <ul class="social-custom list-inline">
                  <li class="list-inline-item"><a href="#"><i class="fa fa-facebook"></i></a></li>
                  <li class="list-inline-item"><a href="#"><i class="fa fa-google-plus"></i></a></li>
                  <li class="list-inline-item"><a href="#"><i class="fa fa-twitter"></i></a></li>
                  <li class="list-inline-item"><a href="#"><i class="fa fa-envelope"></i></a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Top bar end-->
      
      <div id="heading-breadcrumbs">
        <div class="container">
          <div class="row d-flex align-items-center flex-wrap">
            <div class="col-md-7">
              <h1 class="h2">Place new order</h1>
            </div>
            <div class="col-md-5">
              <ul class="breadcrumb d-flex justify-content-end">
                <li class="breadcrumb-item"><a href="/wa-main-page">Home</a></li>
                <li class="breadcrumb-item active">Update order</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div id="content">
        <div class="container">
          <div class="row">
            <div class="col-lg-12">

                <p class="lead">You can update the items of the order by adding, removing or modifying them</p>
                <hr>
                <form class="form-form" action="/wa-store-update-order/{{orderId}}" method="get">
                <div class="table-responsive">
                  <table class="table">
                  <tbody>
                  <tr>
                  <td>
                  <div class="form-group">
                    <label for="order-title">Title<span class="required text-primary">*</span></label>
                    <input id="order-title" type="text" name="name" class="form-control" value="{{orderName}}" disabled>
                  </div>
                  </td>
                  <td></td>
                  </tr>
                  <tr>
                  <td>
                  <div class="form-group">
                    <label for="order-element">items to buy<span class="required text-primary">*</span></label>
                  </div>
                  </td><td></td>
                  </tr>
                  {{#products}}
                  <tr id="wa-row-{{id}}" class="wa-row">
                  <td>
                  <div class="form-group">
                    <input id="order-element-{{id}}" type="text" name="productNames[]" value="{{name}}" class="form-control">
                  </div>
                  </td>
                  <td><div class="wa-add-class wa-trash-button"></div></td>
                  </tr>
                  {{/products}}
                  <tr class="wa-insert-new-text-box">
                  <td>
                  <div class="box-footer d-flex justify-content-between align-items-center">
                    <div class="left-col">
                      <button type="button" onclick="my_button_click_handler()" class="btn btn-template-outlined"><i class="fa fa-plus"></i> Add item</button>
                    </div>
                    <div class="right-col">
                      <button type="button" onclick="window.location.href='/wa-main-page'" class="btn btn-secondary">Cancel update<i class="fa fa-close"></i></a></button>
                      <button type="submit" id="submit-order-button" class="btn btn-template-outlined">Proceed to checkout<i class="fa fa-chevron-right"></i></button>
                    </div>
                  </div>
				  </td>
                  </tr>
                  </tbody>
                  </table>
                  </div>
                </form>

            </div>
          </div>
        </div>
      </div>
      <!-- GET IT-->
      <div class="get-it">
        <div class="container">
        </div>
      </div>
    </div>
    <!-- Javascript files-->
    <script src="/vendor/jquery/jquery.min.js"></script>
    <script src="/vendor/popper.js/umd/popper.min.js"> </script>
    <script src="/vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="/vendor/jquery.cookie/jquery.cookie.js"> </script>
    <script src="/vendor/waypoints/lib/jquery.waypoints.min.js"> </script>
    <script src="/vendor/jquery.counterup/jquery.counterup.min.js"> </script>
    <script src="/vendor/owl.carousel/owl.carousel.min.js"></script>
    <script src="/vendor/owl.carousel2.thumbs/owl.carousel2.thumbs.min.js"></script>
    <script src="/js/jquery.parallax-1.1.3.js"></script>
    <script src="/vendor/bootstrap-select/js/bootstrap-select.min.js"></script>
    <script src="/vendor/jquery.scrollto/jquery.scrollTo.min.js"></script>
    <script src="/js/front.js"></script>
  </body>
</html>